<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>RAID 4</title>
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <link href="Content/raid.css" rel="stylesheet" />
</head>
<body style="background-color: #F8F8FF">
    <div class="container">
        <br />
        <div class="well">
            <h1>Choose a specific RAID level!</h1>
            <div class="btn-group btn-group-lg" role="group" aria-label="...">
                <a role="button" class="btn btn-default" href="./raid0.html">0</a>
                <a role="button" class="btn btn-default" href="./raid1.html">1</a>
                <button type="button" class="btn btn-default">2</button>
                <button type="button" class="btn btn-default">3</button>
                <button type="button" class="btn btn-default active">4</button>
                <button type="button" class="btn btn-default">5</button>
                <button type="button" class="btn btn-default">6</button>
                <button type="button" class="btn btn-default">1+0</button>
            </div>
        </div>

        

        <div class="well" style="min-height: 600px;">
            <div class="row">
                <div class="col-md-1">
					<div style="position: absolute; width:400px; height: 200px; left: 400px;top: -10px;border: 2px;border-style: dashed;border-color: blue;"> </div>
					<h3 style="position: absolute; left: 820px;">RAID controller</h3>
					
                    <img src="Content/Images/server.png" height="200" width="128" />
                    <h3>Server</h3>
                </div>  
                <div class="col-md-3" id="data-blocks"></div>
            </div>  
            <div class="row">
                <div class="col-md-12" id="disk-images"></div>
            </div>     
        </div>
        <div class="row">
            <div class="col-md-12">
				<button type="button" id="write" class="btn btn-primary btn-lg">Write</button>
                <button type="button" id="read" class="btn btn-primary btn-lg">Read</button>
				<button type="button" id="failure" class="btn btn-primary btn-lg">Disk failure</button>
                <button type="button" id="reload" class="btn btn-default btn-lg">Reload page</button>
            </div>
        </div> 
        <br />
		
		<div class="panel panel-primary">
            <div class="panel-heading">RAID LEVEL 4: ...</div>
            <div class="panel-body">
                RAID Level 0 requires a minimum of 2 drives to implement
            </div>
            <div class="panel-footer">
                <b>Characteristics and Advantages</b>
                <ul>
                    <li>RAID 0 implements a striped disk array, the data is broken down into blocks and each block is written to a separate disk drive</li>
                    <li>I/O performance is greatly improved by spreading the I/O load across many channels and drives</li>
                    <li>Best performance is achieved when data is striped across multiple controllers with only one drive per controller</li>
                    <li>No parity calculation overhead is involved</li>
                    <li>Very simple design</li>
                    <li>Easy to implement</li>
                </ul>   
                <b>Disadvantages</b>
                <ul>
                    <li>Not a "True" RAID because it is NOT fault-tolerant</li>
                    <li>The failure of just one drive will result in all data in an array being lost</li>
                    <li>Should never be used in mission critical environments</li>
                </ul> 
                <b>Recommended Applications</b>
                <ul>
                    <li>Video Production and Editing</li>
                    <li>Image Editing</li>
                    <li>Pre-Press Applications</li>
                    <li>Any application requiring high bandwidth</li>
                </ul> 
            </div>
        </div>
    </div>

    <script src="Scripts/jquery-2.1.3.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script type="text/javascript">
		// Reverse plugin
		jQuery.fn.reverse = [].reverse;
		
		//constants
		var diskSpacing = 200;
		var diskCount = 4;
		var dataBlockCount = 3;
		var animationDuration = 200;
		var animationDelay = 80;
		
		$( document ).ready ( function () {
			// Izveido diskus
            var diskImages = [];
			for (var i = 0; i < diskCount; i++) {
                diskImages.push("di" + i);
            }
			
			for (var i = 0; i < diskImages.length; i++) {
                $("#disk-images").append('<img src="Content/Images/disk.png" id="' + diskImages[i] + '" class="disk-image" />');
            }
			
            $("#disk-images").append('<h3 id="diskArrayTitle">Disk array</h3>');
			
			var leftImage = 200;
            $('#disk-images img').each(function (i, elem) {
                $(elem)
                    .show()
                    .animate({ left: leftImage + 'px' }, "fast");

                leftImage += diskSpacing;
            });
			$('#diskArrayTitle')
                .animate({ left: '520px' }, "fast")
                .animate({ top: '265px' }, "fast");
        });
		
		
        $("#write").click(function () {
            WriteDataBlocks(animationDelay, animationDuration);
        });
		
		$("#read").click(function () {
            WriteDataBlocks(0, 0);
			window.setTimeout(function() {
				ReadDataBlocks(animationDelay, animationDuration);
				window.setTimeout(function() {
					SendDataToServer(animationDelay, animationDuration);
				}, animationDuration * 5);
			}, animationDuration * 2);
        });
		
		$("#failure").click(function () {
            WriteDataBlocks(0, 0);
			RuinDisk(0);
			window.setTimeout(function() {
				ReadDataBlocks(animationDelay, animationDuration);
				ReadParity(animationDelay, animationDuration);
				window.setTimeout(function() {
					SendDataToServer(animationDelay, animationDuration);
				}, animationDuration * 5);
			},animationDuration*2);
        });

        $("#reload").click(function () {
            location.reload(true);
        });
		
		function WriteDataBlocks(delay, duration) {
			if( $('#DataBlock1').length ) {
				 return;
			}
			
            var dataBlocks = [];

            for (var i = 0; i < dataBlockCount; i++) {
                dataBlocks.push("DataBlock" + (i+1));
            }

            for (var i = 0; i < dataBlocks.length; i++) {
                $("#data-blocks").append('<div id="' + dataBlocks[i] + '" class="data-block" style="top:'+i*40+'px">' + dataBlocks[i] + '</div>');
            }
            
			//Blocks go to controller
			$('#data-blocks div').each(function (i, elem) {
                $(elem)
                    .show()
                    .animate({ left: '400px' }, duration);
            });
			
			
			window.setTimeout(function() {
				//Controller creates parity or mirror blocks
				$("#data-blocks").append('<div class="parity-block">Parity </div>');
				$("#data-blocks div.parity-block").show();
			},duration);
            
			
			window.setTimeout(function() {
				var left = 130;
				
				//Data blocks go to disk
				$('#data-blocks div.data-block').each(function (i, elem) {
					$(elem)
						.delay(i * delay)
						.animate({ top: '200px' }, duration)
						.animate({ left: left + 'px' }, duration)
						.animate({ top: '300px' }, duration);
						
					left += diskSpacing;
				});
				
				// Parity blocks go to disk
				$('#data-blocks div.parity-block').each(function (i, elem) {
					$(elem)
						.animate({ top: '200px' }, duration)
						.animate({ left: left + 'px' }, duration)
						.animate({ top: '300px' }, duration);
				});
			},duration*2);
			
		};
		
		function ReadDataBlocks(delay, duration) {
			//Data blocks go to controller											
			$('#data-blocks div.data-block').each(function (i, elem) {
                $(elem)
					.delay(i * delay)
                    .animate({ top: '200px' }, duration)
                    .animate({ left: '400px' }, duration)
					.animate({ top: i*40+'px' }, duration);
            });
		};
		
		function ReadParity(delay, duration) {
			//Parity blocks go to controller		
			$('#data-blocks div.parity-block').each(function (i, elem) {
                $(elem)
					.delay(i * delay)
                    .animate({ top: '200px' }, duration)
                    .animate({ left: '550px' }, duration)
					.animate({ top: '50px' }, duration);
            });
		};
		
		function SendDataToServer(delay, duration) {
			$('#data-blocks div.data-block').each(function (i, elem) {
                $(elem)
					.delay(delay)
                    .animate({ left: '100px' }, duration);
            });
		};
		
		function RuinDisk(index) {
			$("#di" + index).attr("src","Content/Images/diskX.png");
		};
		
    </script>
</body>
</html>
